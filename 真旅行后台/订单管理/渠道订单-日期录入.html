<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>B2C 真旅行后台 产品管理 新增产品-价格日历</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.reset.css">
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <link rel="stylesheet" type="text/css" href="../../css/maintain/common.css">
    <link rel="stylesheet" type="text/css" href="../../css/maintain/orderManagement.css">

    <script type="text/javascript" src="../../js/base/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../../js/bootdist/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../js/vendor/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="../../js/vendor/bootstrap-datepicker.zh-CN.min.js"></script>
    <script type="text/javascript" src="../../js/global/global.js"></script>
    <script type="text/javascript" src="../../js/vendor/underscore.js"></script>
    <script type="text/javascript" src="../../js/maintain/common.js"></script>

    <!--[if lte IE 9]>
    <script type="text/javascript" src="../../js/base/html5.js"></script>
    <script type="text/javascript" src="../../js/base/respond.js"></script>
    <![endif]-->
       
</head>
<body>
    <div class="wrapper clearfix">
        <header class="main-header hoveringModel">
            <div class="stairMenuContent topMenuFonts">
                <div class="wrap clearfix">
                    <div class="navLeft">
                        <a class="logo" href="/"></a>
                    </div>
                    <div class="headRightOperate">
                        <span class="userContent">Hi，千颂伊</span>
                        <label class="emailContent">
                            <i class="emailIcon"></i>
                            <span class="emailFonts">99</span>
                        </label>
                        <a href="javascript:void(0);" class="exitFonts">退出</a>
                    </div>
                </div>
            </div>
            <div class="headSecondLevel headBtn clearfix">
                <span class="leftBtn">
                    <a href="javascript:void(0);" class="returnBtn">< 返回</a>
                </span>
                <ul class="middleContent">
                    <li>
                        <a href="javascript:void(0);">产品选择</a>
                    </li>
                    <li class="active">
                        <a href="javascript:void(0);">日期选择</a>
                        <i class="downArrowIcon"></i>
                    </li>
                    <li>
                        <a href="javascript:void(0);">乘客及支付信息</a>                        
                    </li>
                </ul>
                <span class="rightBtn">
                    <button class="commonButton red-fe6869Button">保 存</button>
                    <button class="commonButton whiteBtn" onclick="window.location.href='渠道订单-乘客及支付信息录入.html'">下一步</button>
                </span>
            </div>
        </header>
        <div class="main-container changeMainContent">
            <section class="whiteBg">
                <div class="channelTitle">出行日期录入</div>
                <div class="price-order-block clearfix">
                    <div class="custom-price-calendar-container left-price-info">
                        <ul class="week-day-title top clearfix">
                            <li>日</li>
                            <li>一</li>
                            <li>二</li>
                            <li>三</li>
                            <li>四</li>
                            <li>五</li>
                            <li>六</li>
                        </ul>
                        <div class="common-tab-bar">
                            <div class="tab-top"></div>
                            <div class="cal-mon-tab-container">
                                <ul class="common-tab calendar-month-tab clearfix"></ul>
                            </div>
                            <div class="mon-nav-btns">
                                <span class="pre-mon-btn"></span>
                                <span class="next-mon-btn"></span>
                            </div>
                        </div>
                        
                        <div class="calendarTables">
                            <ul class="week-day-title clearfix">
                                <li>日</li>
                                <li>一</li>
                                <li>二</li>
                                <li>三</li>
                                <li>四</li>
                                <li>五</li>
                                <li>六</li>
                            </ul>
                        </div>
                    </div>
                    <div class="right-cont-block" style="margin-top:6px;">
                        <div class="set-price-container" style="min-height:555px;margin-left:15px;">
                            <div class="sub-title" style="margin-top:0;">团号</div>
                            <div class="rightdate">
                                请于左侧选择出行日期
                            </div>
                            <div class="sub-title">出行人数</div>
                            <table style="margin-top:20px;">
                                <colgroup>
                                    <col width="40"/>
                                    <col width=""/>
                                </colgroup>
                                <tbody>
                                    <tr>
                                        <th>成人:</th>
                                        <td>
                                            <div class="dropdown" style="width: 56px;margin:0 8px 0 5px;">
                                                <a href="javascript:void(0);" data-toggle="dropdown" class="dropdownBtn" aria-expanded="false" style="padding:0 5px;">
                                                    <span class="activeFonts">1人</span>
                                                    <span class="caret"></span>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li class="active"><a href="javascript:void(0);">1人</a></li>
                                                    <li><a href="javascript:void(0);">2人</a></li>
                                                    <li><a href="javascript:void(0);">3人</a></li>
                                                    <li><a href="javascript:void(0);">4人</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                        <th>儿童:</th>
                                        <td>
                                            <div class="dropdown" style="width: 56px;margin:0 10px;">
                                                <a href="javascript:void(0);" data-toggle="dropdown" class="dropdownBtn" aria-expanded="false" style="padding:0 5px;">
                                                    <span class="activeFonts">1人</span>
                                                    <span class="caret"></span>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li class="active"><a href="javascript:void(0);">1人</a></li>
                                                    <li><a href="javascript:void(0);">2人</a></li>
                                                    <li><a href="javascript:void(0);">3人</a></li>
                                                    <li><a href="javascript:void(0);">4人</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>    
        <footer>Copyright © 2015 天地行 All Rights Reserved. 沪ICP备08101503号</footer>
    </div>

    <script>
        $(function(){
    
            // 触发验证
            $(".oper-btn .save").click(function(){
                $(".set-price-container").customValidate({
                    validateAll: true
                });
            });
    
            //  定义日期数据格式
    
            var data = [{
                month: "2015-09",
                    monthData: [{
                        day: 22,
                        soldNum: 3,
                        totalNum: 10,
                        adultPrice: 1250,
                        childPrice: 850,
                        flightFlag: true,
                        hotelFlag: true,
                        isClosed: true,
                        canOrder: true
                    }, {
                        day: 23,
                        soldNum: 10,
                        totalNum: 10,
                        adultPrice: 1250,
                        childPrice: 850,
                        flightFlag: false,
                        hotelFlag: true,
                        isClosed: true,
                        canOrder: false
                    }, {
                        day: 24,
                        soldNum: 3,
                        totalNum: 10,
                        adultPrice: 1250,
                        childPrice: null,
                        flightFlag: true,
                        hotelFlag: false,
                        isClosed: false,
                        canOrder: false
                    }, {
                        day: 25,
                        soldNum: 3,
                        totalNum: 10,
                        adultPrice: 1250,
                        childPrice: 850,
                        flightFlag: true,
                        hotelFlag: true,
                        isClosed: false,
                        canOrder: true
                    }]
                },
                {
                month: "2015-10",
                monthData: [{
                    day: 3,
                    soldNum: 3,
                    totalNum: 10,
                    adultPrice: 1250,
                    childPrice: 850,
                    flightFlag: true,
                    hotelFlag: true,
                    isClosed: false,
                    canOrder: true
                }, {
                    day: 6,
                    soldNum: 10,
                    totalNum: 10,
                    adultPrice: 1250,
                    childPrice: 850,
                    flightFlag: false,
                    hotelFlag: true,
                    isClosed: false,
                    canOrder: true
                }]
            }];
    
            //  调用方法
            //  param1: 包裹日历的外层容器元素;  param2: 填充日历所需要数据
            //  以下独立出的 funntion 可自行封装在js文件中，引入js文件
            //genePriceCalendar(".price-calendar", data);            
            
        });
    
    function moveMonth(date, dir) {
    
        if (!(date instanceof Date)) {   //  如果date不是日期类型
            return undefined;
        }
    
        if (!dir) {   // 如果 dir 参数为空，返回date
            return (date instanceof Date) ? date : undefined;
        }
    
        var dir_num = parseInt(dir),
            dir_absNum = Math.abs(dir_num),
            year = date.getFullYear(),
            month = date.getMonth(),
            day = date.getDate(),
            result_date;
    
        if (dir_num < 0) {   //  日期往前滚
            result_date = new Date(year, month - dir_absNum);
    
        } else if (dir_num > 0) {  // 日期往后滚
            result_date = new Date(year, month + dir_absNum);
        }
        return result_date;
    }
    
    </script>

<script>
        $(function(){  

            //  生成初始日历结构---只包含价格信息没有交互

            var data = [
                { month : "2015/05/01",   //  数据月份
                  info : [
                    //  几号       剩余库存      售价
                    {dayDate: 1, leftNum: 10, price: 2000, canOrder: true},   //  当月下的每天数据
                    {dayDate: 3, leftNum: 22, price: 998, canOrder: true},
                    {dayDate: 9, leftNum: 0, price: 20000, canOrder: true},
                    {dayDate: 22, leftNum: 10, price: 20000, canOrder: true},
                    {dayDate: 23, leftNum: 0, price: 88888, canOrder: false},
                    {dayDate: 26, leftNum: 12, price: 1999, canOrder: true},
                    {dayDate: 31, leftNum: 22, price: 2499, canOrder: false}
                  ]
                },
                { month : "2015/06/01",   
                  info : [{dayDate: 1, leftNum: 10, price: 2000, canOrder: false}]
                },
                { month : "2015/07/01",   
                  info : [{dayDate: 31, leftNum: 10, price: 2000, canOrder: false}]
                },
                { month : "2015/08/01",  
                  info : []
                },
                { month : "2015/09/01",  
                  info : []
                },
                { month : "2015/10/01",  
                  info : []
                },
                { month : "2016/01/01",  
                  info : []
                },
                { month : "2016/03/01",  
                  info : []
                }
            ];
            setCalendar(data, ".calendarTables");

        //  生成月份标题
        $(".custom-price-calendar-container ul.common-tab").append(geneTabSwitchMonth(data));

        var w = $(".calendar-month-tab .tab-item").outerWidth() + $(".calendar-month-tab .placement").outerWidth();

        if (data.length > 6) {
            $("ul.calendar-month-tab").css("width", w * data.length + $(".calendar-month-tab .placement").outerWidth() + "px");
            $(".cal-mon-tab-container").addClass("limit-width");
        }
            
            $(".calendar-month-tab .tab-item").eq(0).addClass("current");
            $(".common-tab").tabBar();
            $(".calTable").hide();
            $(".calTable").eq(0).show();

            checkMonthNav();

            $(".calendar-month-tab").find("li.tab-item").each(function(index){
                $(this).click(function(){
                    $(".calTable").hide();
                    $(".calTable").eq(index).show();
                    checkMonthNav();
                });
            });

            $('.tdCont .onsale').click(function(){
                    var date = $(this).find('.dateDay').attr('data-dayvalue');
                    var week ='(周' + $('.week-day-title li').eq($(this).parent('.tdCont').parent('td').index()).text() + ')';
                    $('.right-cont-block .rightdate').text(date+' '+week);
                    $('.right-cont-block .rightdate').addClass('datecolor');
            });
            
        });    

    //  按钮置灰不可点
    function checkMonthNav() {
        if ($(".tab-item.current").nextAll('.tab-item').length == 0) {
            $(".next-mon-btn").addClass("disabled");
        } else {
            $(".next-mon-btn").removeClass("disabled");
        }

        if ($(".tab-item.current").prevAll('.tab-item').length == 0) {
            $(".pre-mon-btn").addClass("disabled");
        } else {
            $(".pre-mon-btn").removeClass("disabled");
        }
    }

    function setCalendar(data, ele) {
        for (var i = 0; i < data.length; i++) {
            var monthInfo = data[i];  // 获得当前月份的数据信息

            var calStr = "<table class='calTable ct-" + data[i].month.split('/')[0] + "-" +
                            data[i].month.split('/')[1] + "'><tr>";  // 拼接字符串生成表格日期内容

            var curentMonthDate = new Date(monthInfo.month);
            var nextMonthDate = new Date(curentMonthDate.getFullYear(), curentMonthDate.getMonth() + 1,
                curentMonthDate.getDate());
            var monthDays = (nextMonthDate - curentMonthDate)/(1000*60*60*24);  // 获得当前月天数

            var firstWeekDay = curentMonthDate.getDay();  // 获得当前月1号是周几, 范围0-6
            var lastWeekDay = nextMonthDate.getDay() - 1 < 0 ? 6 : nextMonthDate.getDay() - 1; 
            // 计算当月最后一天是周几，填补日历最后的空格

            var currentDay = 1;  // 从1号开始排列当月的日期

            for (var j = 0; j < firstWeekDay; j++) {  // 当月1号之前td为空
                calStr += "<td class='empty'><div class='tdCont'></div></td>";
            }

            for (; currentDay <= monthDays; currentDay++) {

                var w1 = firstWeekDay == 0 ? 7 : firstWeekDay;

                if (currentDay % 7 == (7 - w1) && currentDay != monthDays) {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td></tr><tr>";
                } else if (currentDay == monthDays) {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td>";
                    for (var t = 0; t < 6 - lastWeekDay; t++) {
                        calStr += "<td class='empty'><div class='tdCont'></div></td>";
                    }
                    calStr += "</tr></table>";
                } else {
                    calStr += "<td>" + geneTdContent(currentDay, monthInfo) + "</td>";
                }
            }
            $(ele).append(calStr);
        }
    }

    function getDayInfo(currentDay, monthInfo) {
        for (var i = 0; i < monthInfo.info.length; i++) {
            if (monthInfo.info[i].dayDate == currentDay) {
                return monthInfo.info[i];
            }
        }
        return null;
    }

    function geneTdContent(currentDay, monthInfo) {
        var dayInfo = getDayInfo(currentDay, monthInfo);
        var tdCont = "";

        var d = currentDay < 10 ? '0' + currentDay : currentDay;
        var dateStr = monthInfo.month.slice(0, 7) + "/" + d;
        
        if (!!dayInfo) {  

            if (!dayInfo.canOrder) {   //  不可预订, 显示未开放状态

                tdCont += "<div class='tdCont'><div class='priceCover canntorder clearfix'><div class='dateDay' data-dayvalue='" + dateStr + "'>" + dayInfo.dayDate + "</div>";
                tdCont += "<div class='right-block'><div class='leftNum'>未开放</div>";
                tdCont += "<div class='price'>￥" + dayInfo.price + "</div></div></div></div>";

            } else {   //   可预订，显示库存状态

                if (dayInfo.leftNum == 0) {
                    tdCont += "<div class='tdCont'><div class='priceCover soldout clearfix'><div class='dateDay' data-dayvalue='" + dateStr + "'>" + dayInfo.dayDate + "</div>";
                    tdCont += "<div class='right-block'><div class='leftNum'>售完</div>";
                    tdCont += "<div class='price'>￥" + dayInfo.price + "</div></div></div></div>";
                } else {
                    tdCont += "<div class='tdCont'><div class='priceCover onsale clearfix'><div class='dateDay' data-dayvalue='" + dateStr + "'>" + dayInfo.dayDate + "</div>";

                    tdCont += "<div class='right-block'><div class='leftNum'>余" + dayInfo.leftNum + "</div>";

                    tdCont += "<div class='price'>￥" + dayInfo.price + "</div></div></div></div>";
                    
                }
            }    
        } else {
            tdCont += "<div class='tdCont'><div class='priceCover noPrice'><div class='dateDay' data-dayvalue='" + dateStr + "'>" + currentDay + "</div></div></div>";
        }
        return tdCont;
    }

    function geneTabSwitchMonth(data) {
        var liStr = "";
        for (var i = 0; i < data.length; i++) {
            var temp = new Date(data[i].month);

            liStr += "<li class='placement'></li>";
            liStr += "<li name='" + data[i].month + "' class='tab-item'>" + temp.getFullYear() + "年" +
                        (temp.getMonth() + 1 < 10 ? '0' + (temp.getMonth() + 1) : (temp.getMonth() + 1)) + "月</li>";
        }

        if (data.length > 6) {
            $(".mon-nav-btns").show();
            liStr += "<li class='placement'></li>";
        } else if (data.length == 6) {
            liStr += "<li class='placement'></li>";
        } else {
            liStr += "<li class='placement'></li><li class='rest'></li>";
        }

        return liStr;
    }
    </script>

<script type="text/javascript">
    $(".pre-mon-btn").click(function(){

        var $this = $(this);

        if (!$this.hasClass("disabled")) {

            if ($(".tab-item.current").prevAll('.tab-item').length > 0) {

                var offsetLeft = $(".calendar-month-tab .tab-item.current").position().left,
                    curOff = $(".calendar-month-tab").css("margin-left") != "auto" ? parseInt($(".calendar-month-tab").css("margin-left")) : 0;

                if (offsetLeft < 100) {
                    var w = $(".calendar-month-tab .tab-item").outerWidth() + $(".calendar-month-tab .placement").outerWidth();
                    $(".calendar-month-tab").css("margin-left", curOff + w + "px");
                }
                $(".tab-item.current").prevAll('.tab-item').eq(0).trigger("click");
            }
        }
    });

    $(".next-mon-btn").click(function(){

        var $this = $(this);

        if (!$this.hasClass("disabled")) {

            if ($(".tab-item.current").nextAll('.tab-item').length > 0) {

                var offsetLeft = $(".calendar-month-tab .tab-item.current").position().left,
                    curOff = $(".calendar-month-tab").css("margin-left") != "auto" ? parseInt($(".calendar-month-tab").css("margin-left")) : 0;

                if (offsetLeft > 500) {
                    var w = $(".calendar-month-tab .tab-item").outerWidth() + $(".calendar-month-tab .placement").outerWidth();
                    $(".calendar-month-tab").css("margin-left", curOff - w + "px");                
                }
                $(".tab-item.current").nextAll('.tab-item').eq(0).trigger("click");
            }
        }
    });

</script>
</body>
</html>